P_DFL
﻿MDBX_GACO_AAH/MDBX_MAIN_AAH﻿

﻿Допеределки
===========
- [ ] передавать в visitor тип страницы не через const char, а через enum.
- [ ] заметить возврат MDBX_NOTFOUND на MDBX_EOF.
- [ ] флажки для mdbx_aa_open() чтобы открывать существующую таблицу с "подбором" её флагов.
- [ ] API для использования преаллоцированных блоков данных для курсоров и транзакций.
- [ ] проверка с -m32.
- [ ] прополоть выключение предупреждений MSVC.
- [ ] убрать MDBX_ALIEN_LOCKING как опцию, вместо этого взвозить флажок "custom locking" в regime и внутри DB.
- [ ] ptrdiff_t в компараторах
- [ ] const для переменных и параметров где возможно.
- [ ] Унифицировать трекинг курсоров.
- [ ] Привести в порядок mdbx_pnl_search.
- [ ] Убрать использование младшего бита в spill_pages_list и зачистить pgno2.
- [ ] Убрать exactp в cursor_set().
- [ ] Изменение MDBX_EXCLUSIVE после открытия БД (только для Linux).
- [?] Изменение MDBX_AA_FLAGS для main после создания БД (если main пустая).

- [ ] Перевод mdbx-tools на С++ и сборка для Windows.
- [ ] Переход на CMake, замена заглушек mdbx_version и mdbx_build.
- [ ] Актуализация README.md
- [ ] Переход на C++11, добавление #pragma detect_mismatch().
- [ ] Убрать MDB_DEBUG (всегда: логирование важный ситуаций и ошибок, опционально: включение ассертов и трассировка).
- [ ] Заменить mdbx_debug на log_trace, и почистить...
- [ ] Заметить максимум assert() на mdbx_assert(env, ...).

Качество и CI
=============
- [ ] Добавить в CI linux сборки для 32-битных таргетов.

Доработки API
=============
- [ ] Поправить/Добавить описание нового API.
- [ ] Добавить возможность "подбора" режима для mdbx_open().
- [?] Переименовать в API: env->db, db->tbl.

Тесты
=====
- [ ] Тестирование поддержки lockless-режима, включая MDBX_EXCLUSIVE.
- [x] Додумать имя и размещение тестовой БД по-умолчанию.
- [ ] Реализовать cleanup в тесте.
- [ ] usage для теста.
- [ ] Логирование в файл, плюс более полный progress bar.
- [ ] Опция игнорирования (пропуска части теста) при переполнении БД.
- [ ] Базовый бенчмарк.

Развитие
========
- [ ] Отслеживание времени жизни AAH-хендлов.
- [ ] Отрефакторить freelist_save().
- [ ] Хранить "свободный хвост" не связанный с GACO в META.
- [x] Возврат выделенных страниц в unallocated tail-pool.
- [ ] Валидатор страниц БД по номеру транзакции:
      ~0 при переработке и номер транзакции при выделении,
      проверять что этот номер больше головы реклайминга и не-больше текущей транзакции.
- [ ] Размещение overflow-pages в отдельном mmap/файле с собственной геометрией.
- [ ] Зафиксировать формат БД.
- [ ] Валидатор страниц по CRC32, плюс контроль номер транзакии под модулю 2^32.
- [ ] Валидатор страниц по t1ha c контролем снимков/версий БД на основе Merkle Tree.
- [ ] Возможность хранения ключей внутри data (libfptu).
- [ ] Асинхронная фиксация (https://github.com/leo-yuriev/libmdbx/issues/5).
- [ ] (Пере)Выделять память под IDL-списки с учетом реального кол-ва страниц, т.е. max(MDB_IDL_UM_MAX/MDB_IDL_UM_MAX, npages).

-----------------------------------------------------------------------

Сделано
=======
- [x] разделение errno и GetLastError().
- [x] CI посредством AppVeyor.
- [x] тест конкурентного доступа.
- [x] тест основного функционала (заменить текущий треш).
- [x] uint32/uint64 в структурах.
- [x] Завершить переименование.
- [x] Макросы версионности, сделать как в fpta (cmake?).
- [x] Попробовать убрать yield (или что там с местом?).
- [x] trinity для copy/compaction.
- [x] trinity для mdbx_chk и mdbx_stat.
- [x] проверки с meta_eq.
- [x] Не проверять режим при открытии в readonly.
- [x] Поправить выбор tail в mdbx_chk.
- [x] Там-же проверять позицию реклайминга.
- [x] поправить проблему открытия после READ-ONLY.
- [x] static-assertы на размер/выравнивание lck, meta и т.п.
- [x] Зачистить size_t.
- [x] Добавить локи вокруг aah.
- [x] Привести в порядок volatile.
- [x] контроль meta.mapsize.
- [x] переработка формата: заголовки страниц, meta, clk...
- [x] зачистка Doxygen и бесполезных комментариев.
- [x] Добавить поле типа контрольной суммы.
- [x] Добавить поле/флаг размера pgno_t.
- [x] Поменять сигнатуры.
- [x] Добавить мета-страницы в coredump, проверить lck.
- [x] Сделать список для txnid_t, кода sizeof(txnid_t) > sizeof(pgno_t) и вернуть размер pgno_t.
- [x] Избавиться от умножения на размер страницы (заменить на сдвиг).
- [x] Устранение всех предупреждений (в том числе под Windows).
- [x] Добавить 'li_reader_finished_flag'.
- [x] Погасить все level4-warnings от MSVC, включить /WX.
- [x] Проверка посредством Coverity с гашением всех дефектов.
- [x] Полная матрица Windows-сборок (2013/2015/2017).
- [x] Дать возможность задавать размер страницы при создании БД.
- [x] Изменение mapsize через API с блокировкой и увеличением txn.
- [x] Контроль размера страницы полного размера и кол-ва страниц при создании и обновлении.
- [x] Инкрементальный mmap.
- [x] Инкрементальное приращение размера (колбэк стратегии?).
